<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>XMLHTTPRequest-JSON-Ajax Exchanges</title>
    <style>
        <link rel="stylesheet" href="../stylesheets/css/main.css">
    </style>
</head>

<body>
<div>
    <h1 id="intro">XMLHTTPRequest-JSON-Ajax Exchanges</h1>

    <input id="Button1" type="button" value="Show Books" onclick="getBooks() " />
    
    <script>
// w3schools attempt (failed)
//    var myReq = new ActiveXObject("Microsoft.XMLHTTP");
//    var myReq = new XMLHttpRequest;
    
//    var myReq = new XMLHttpRequest();
    function getBooks() {
        var myReq = new ActiveXObject("Microsoft.XMLHTTP");
        var myReq = new XMLHttpRequest;
    
        var myReq = new XMLHttpRequest();
        if (window.XMLHttpRequest)
            {
                var url = "http://www.w3schools.com/xsl/books.xml"
                myReq.open("GET", url, false)
                myReq.send();
                alert(myReq.responseXML.xml);          
            }
     }
     
    </script>
</div>  
    
<div>    
    <h1>Ajax Extraction of this Site</h1>
        <button onclick="requestData('/repos/jrmacanada/cit261-mac')">Get Data</button>
        <pre>
            <div id="output"></div>
        </pre>

    <script>
    function ajax(url, callback) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function(){
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
                callback(xmlhttp.responseText);
            } else {
                // handle the request
            }
        }
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
    }

    function requestData(endpoint) {
        var root = 'https://api.github.com';
        ajax(root + endpoint, function(data) {
            document.getElementById('output').innerHTML = data;
        });
    }       
    </script>
</div>    

 <div class="content">
    <h1>Find Music Artists</h1>
        <input onkeyup="get_artists(this.value)" type="text">
        
    <script>
    function ajax_request(url, request_type, callback) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function(){
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
                callback(xmlhttp.responseText);
            } 
        }
        xmlhttp.open(request_type, url, true);
        xmlhttp.send();
    } 
    </script>

    <script>
    var API_ENDPOINT = 'https://api.spotify.com/v1/';

    function get_artists(input) {
        if (input === '') {
            return false;
        }

        ajax_request(API_ENDPOINT + 'search?q=' + encodeURIComponent(input) + '&type=artist', 'GET', function(json) {
            var obj = JSON.parse(json);
            var results = obj.artists.items;
            var search_results = document.getElementById('search_results');
            search_results.innerHTML = '';

            console.log(obj);

            for (var i = 0; i < results.length; i++) {
                var artist = results[i].name;
                var genre = results[i].genres;
                var external_link = results[i].external_urls.spotify;
                var image = results[i].images[0].url;

                var div = document.createElement('div');
                div.classList.add('result');
                div.innerHTML = '<a href="' + external_link + '">' +
                                    '<div class="result_image">' +
                                        '<img src="' + image + '">' +
                                    '</div>' +
                                    '<div class="result_desc">' +
                                        '<div>Artist: ' + artist + '</div>' +
                                        '<div>Genre: ' + genre + '</div>' +
                                    '</div>' +
                                '</a>';
                search_results.appendChild(div);
            }
        });
    }
    </script>
    <div id="search_results"></div>
</div>
    
<p>Return to XMLHTTPRequest-JSON-Ajax Exchanges page, click to <a href="../content/p08--xml-json.html" title="Go Back">GO BACK</a></p>

</body>
</html>


